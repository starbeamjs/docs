{"version":3,"sources":["../src/Code.tsx"],"names":[],"mappings":"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","file":"Code.js","sourcesContent":["import { defineComponent, type Ref, type Slots } from \"vue\";\nimport { onMounted, ref } from \"vue\";\nimport { STORAGE } from \"./lang.js\";\nimport {\n  codeSnippet,\n  toggler as togglerClass,\n  section as sectionClass,\n  js as jsClass,\n  ts as tsClass,\n} from \"./Code.css.js\";\n\nexport default defineComponent({\n  setup(_, { slots }) {\n    const js = ref();\n    const ts = ref();\n\n    const container = ref();\n\n    onMounted(() => {\n      mountElements(ts, js, container);\n    });\n\n    return () => (\n      <section\n        class={[\n          sectionLangClass(STORAGE.currentLang),\n          \"code-block\",\n          sectionClass,\n          codeSnippet,\n        ]}\n        ref={container}\n      >\n        {toggler()}\n        {langSlots(slots, { ts, js })}\n      </section>\n    );\n  },\n});\n\nfunction toggler() {\n  return (\n    <section class={[togglerClass, \"code-toggler\"]}>\n      {langButton(\"js\")}\n      {langButton(\"ts\")}\n    </section>\n  );\n}\n\nfunction langSlots(\n  slots: Slots,\n  refs: { ts: Ref<HTMLElement>; js: Ref<HTMLElement> }\n) {\n  return [\n    langSlot(slots, \"ts\", refs.ts),\n    langSlot(slots, \"js\", refs.js),\n  ];\n}\n\nfunction langSlot(\n  slots: Slots,\n  lang: \"ts\" | \"js\",\n  ref: Ref<HTMLElement>\n): ReturnType<typeof import(\"vue\").h> | void {\n  const slot = slots[lang];\n\n  if (slot) {\n    return (\n      <div class={[langClass(lang), `lang-${lang}`]} ref={ref}>\n        {slot()}\n      </div>\n    );\n  }\n}\n\nfunction langButton(lang: \"ts\" | \"js\") {\n  return (\n    <button\n      type=\"button\"\n      class={[\"toggler-button\", langClass(lang)]}\n      onClick={() => {\n        console.info(\"clicked\", lang);\n        STORAGE.lang = lang;\n      }}\n    >\n      {lang}\n    </button>\n  );\n}\n\nfunction createToggler(): HTMLElement {\n  const toggler = document.createElement(\"section\");\n  toggler.className = togglerClass;\n  return toggler;\n}\n\nfunction label(text: string) {\n  const label = document.createElement(\"span\");\n  label.innerText = text;\n  return label;\n}\n\nfunction button(text: string, callback: () => void) {\n  const button = document.createElement(\"button\");\n  button.setAttribute(\"type\", \"button\");\n  button.innerText = text;\n  button.addEventListener(\"click\", callback);\n\n  return button;\n}\n\nconst LANG_KEY = \"default-lang\";\nconst DEFAULT_LANG = \"js\";\n\nfunction addToggle(\n  container: Element,\n  text: string,\n  callback: () => void\n) {\n  const toggler = createToggler();\n\n  if (text === \"typescript\") {\n    toggler.appendChild(label(\"ts\"));\n    toggler.appendChild(button(\"js\", callback));\n  } else {\n    toggler.appendChild(button(\"ts\", callback));\n    toggler.appendChild(label(\"js\"));\n  }\n\n  container.prepend(toggler);\n}\n\nfunction mountElements(\n  ts: Ref<HTMLElement>,\n  js: Ref<HTMLElement>,\n  container: Ref<HTMLElement>\n) {\n  onMounted(() => {\n    const tsSection = ts.value;\n    const jsSection = js.value;\n\n    const tsContainer = tsSection.querySelector(\n      \"[class*=language-]\"\n    );\n\n    assert(tsContainer, exists);\n\n    addToggle(tsContainer, \"typescript\", () => {\n      STORAGE.lang = \"js\";\n    });\n\n    const jsContainer = jsSection.querySelector(\n      \"[class*=language-]\"\n    );\n\n    assert(jsContainer, exists);\n\n    addToggle(jsContainer, \"javascript\", () => {\n      STORAGE.lang = \"ts\";\n    });\n  });\n\n  // TODO: Generate the right markdown\n  onMounted(() => {\n    let x = 1;\n    for (const item of container.value.querySelectorAll(\n      \"[class*=language-]\"\n    )) {\n      assert(item.parentElement, exists);\n      item.parentElement.classList.add(\"code-container\");\n\n      for (const child of item.querySelectorAll(\n        \".code-container\"\n      ) as NodeListOf<Element>) {\n        child.classList.remove(\"code-container\");\n      }\n    }\n    // const element =\n  });\n}\n\nfunction assert<T, U extends T>(\n  value: T,\n  check: (value: T) => value is U\n): asserts value is U {\n  if (!check(value)) {\n    throw new Error(`Expected ${check.name}`);\n  }\n}\n\nfunction exists<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined;\n}\n\nfunction langClass(lang: \"ts\" | \"js\"): string {\n  return lang === \"ts\" ? tsClass : jsClass;\n}\n\nfunction sectionLangClass(lang: \"ts\" | \"js\"): string[] {\n  return [langClass(lang), `language-${lang}`];\n}\n"]}