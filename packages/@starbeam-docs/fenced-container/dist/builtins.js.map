{"version":3,"sources":["../src/builtins.ts"],"names":[],"mappings":"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","file":"builtins.js","sourcesContent":["import { parserPlugin } from \"@jsergo/mdit\";\nimport \"@mdit-vue/plugin-sfc\";\nimport parseFence from \"fenceparser\";\nimport {\n  Builtins,\n  CUSTOM_EL,\n  CustomEl,\n  Title,\n  UnparsedContent,\n} from \"./define.js\";\nimport { Do, El } from \"./nodes.js\";\nimport type { AttrPart } from \"./tokens.js\";\n\ntype OBJECT = ReturnType<typeof parseFence>;\ntype VALUE = OBJECT[keyof OBJECT];\n\nconst BUILTINS = Builtins.empty()\n  .basic(\"info\", {\n    defaultTitle: \"INFO\",\n    color: \"blue\",\n  })\n  .basic(\"construction\", {\n    defaultTitle: \"Under Construction\",\n    color: \"orange\",\n  })\n  .basic(\"warning\", {\n    color: \"yellow\",\n  })\n  .basic(\"error\", {\n    color: \"red\",\n  })\n  .basic(\"tip\", {\n    defaultTitle: null,\n    color: \"green\",\n  })\n  .basic(\"callout\", { defaultTitle: null })\n  .custom(\"ðŸ’¡\", ({ title, content }) =>\n    CustomEl(\n      \"lightbulb\",\n      {\n        border: \"se\",\n        color: \"yellow\",\n        style: {\n          \"padding-block\": \"0.5em\",\n        },\n      },\n      [title, content]\n    )\n  )\n  .custom(\"lang-ts\", ({ content }) =>\n    CustomEl(\"lang-ts\", { color: \"neutral\" }, [content])\n  )\n  .custom(\"em\", ({ title, content }) =>\n    CustomEl(\n      \"em\",\n      {\n        color: \"orange\",\n        border: \"w\",\n        style: {\n          \"font-size\": `calc(1em * var(--sbdoc-ratio))`,\n          \"font-weight\": \"600\",\n          \"border-size\": \"2px\",\n          \"line-height\": \"1\",\n        },\n      },\n      [\n        title\n          .withDefault(\"Key Point\")\n          .map((title) => El(\"h5\", [title])),\n        content,\n      ]\n    )\n  )\n  .custom(\"persona\", ({ title, content }) =>\n    El(\"aside\", { class: [\"persona\", String(title)] }, [content])\n  )\n  .custom(\"details\", ({ title, content, attrs }) => {\n    return El(CUSTOM_EL, { kind: \"details\", color: \"gray\" }, [\n      El(\n        \"details\",\n        {\n          class: [\n            \"content-block\",\n            \"callout-block\",\n            \"container\",\n            ...normalizePart(attrs[\"type\"]),\n          ],\n        },\n        [\n          Do(() => {\n            function titleChild() {\n              switch (attrs[\"type\"]) {\n                case \"deep-dive\":\n                  // TODO:: Generalize\n                  return [El(\"span\", [\"Deep Dive\"]), title];\n                default:\n                  return [title.withDefault(\"Details\")];\n              }\n            }\n\n            return [\n              El(\n                \"summary\",\n                { class: \"custom-block-title\" },\n                titleChild()\n              ),\n            ];\n          }),\n          content,\n        ]\n      ),\n    ]);\n  });\n\nexport const fencedContainerPlugin = parserPlugin({\n  name: \"fenced-container\",\n  before: \"fence\",\n}).block((line, md) => {\n  const matched = line.matchStart(/^(?<ticks>````*)md /);\n\n  if (matched.type === \"error\") {\n    return () => (render) =>\n      render.html(md.error(matched.error));\n  } else if (matched.type === \"unmatched\") {\n    return false;\n  }\n\n  const ticks = matched.raw.groups?.[\"ticks\"] as string;\n  const fenceline = line.string();\n  const info = fenceline.slice(matched.fragment.length);\n\n  // split the fenceline into the part before the first space (kind) and the\n  // part after it (params).\n  const [kind, params] = split2(info, \" \");\n\n  if (kind === undefined) {\n    return false;\n  }\n\n  const builtin = BUILTINS.tryGet(kind);\n\n  if (builtin === undefined) {\n    return false;\n  }\n\n  return () => {\n    const fenceContent = line.next?.until(\n      (line) => line.slice()?.trim() === ticks\n    );\n\n    return (render) => {\n      const { title, attrs = {} } = parseTitle(params);\n\n      const rendered = builtin.render({\n        md,\n        kind,\n        title: Title.provided(title),\n        attrs,\n        content: UnparsedContent.of(fenceContent),\n      });\n\n      return render.tokens(rendered);\n    };\n  };\n});\n\nfunction parseTitle(params: string | undefined): {\n  /**\n   * false means \"no title\"\n   * undefined means \"default title\"\n   *\n   * if no title is provided, the value will be undefined\n   */\n  title?: string | false | undefined;\n  attrs?: Record<string, VALUE> | undefined;\n} {\n  if (params === undefined) {\n    return {};\n  }\n\n  const trimmed = params.trim();\n\n  if (trimmed.length === 0) {\n    return {};\n  }\n\n  const quotedString = trimmed.match(/^\\s*\"(.*)\"\\s*$/);\n\n  if (quotedString?.[1]) {\n    return { title: quotedString[1] };\n  }\n\n  if (trimmed.match(/[{=]/)) {\n    const parsed = parseFence(trimmed);\n\n    const title = getTitle(parsed[\"title\"]);\n\n    return { title, attrs: parsed };\n  }\n\n  return { title: trimmed };\n}\n\nfunction getTitle(title: VALUE): string | false | undefined {\n  if (title === undefined) {\n    return undefined;\n  } else if (title === false || title === null) {\n    return false;\n  } else {\n    return String(title);\n  }\n}\n\nfunction split2(\n  string: string,\n  delimiter: string\n): [string, string | undefined] {\n  const index = string.indexOf(delimiter);\n  const p0 = index === -1 ? string : string.substring(0, index);\n  const p1 = index === -1 ? \"\" : string.substring(index + 1);\n\n  return [p0, p1];\n}\n\nfunction normalizePart(value: VALUE): AttrPart[] {\n  if (value === null || value === undefined) {\n    return [];\n  } else if (Array.isArray(value)) {\n    return value.flatMap(normalizePart).filter(isPresent);\n  } else if (typeof value === \"string\") {\n    return [value];\n  } else if (typeof value === \"number\") {\n    return [String(value)];\n  } else if (typeof value === \"boolean\") {\n    throw Error(\n      `Booleans are not supported as part of an attr array.`\n    );\n  } else {\n    throw Error(\n      `Object are not supported as part of an attr array. You passed ${JSON.stringify(\n        value\n      )}`\n    );\n  }\n}\n\nfunction isPresent<T>(value: T | undefined | null): value is T {\n  return value !== undefined && value !== null;\n}\n"]}